<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Consulta de Fila Cirúrgica</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-6">

            <div class="card shadow-sm">
                <div class="card-body">

                    <h4 class="text-center mb-4">
                        Consulta Posição na Fila Cirúrgica
                    </h4>

                    <label for="codigo" class="form-label">
                        Código informado pelo hospital
                    </label>

                    <div class="input-group mb-3">
                        <input type="text" id="codigo" class="form-control"
                               placeholder="Ex: A7F3K9" maxlength="20">
                        <button class="btn btn-primary" onclick="consultarFila()">
                            Consultar
                        </button>
                    </div>

                    <div id="resultado" class="d-none mt-4">
                        <hr>

                        <p><strong>Status:</strong> <span id="status"></span></p>
                        <p><strong>Sua posição:</strong> <span id="posicao"></span></p>
                        <p><strong>Pacientes à sua frente:</strong> <span id="frente"></span></p>
                        <p><strong>Especialidade:</strong> <span id="especialidade"></span></p>
                        <p class="text-muted small">
                            Última atualização: <span id="atualizacao"></span>
                        </p>
                    </div>

                    <div id="erro" class="alert alert-danger d-none mt-3"></div>

                    <div class="alert alert-warning mt-4 small">
                        ⚠️ A posição na fila é informativa e pode sofrer alterações
                        devido a critérios clínicos e emergenciais.
                    </div>

                </div>
            </div>

        </div>
    </div>
</div>

<script>
function consultarFila() {
    const codigo = document.getElementById('codigo').value.trim();

    if (!codigo) {
        alert('Informe o código.');
        return;
    }

    fetch(`/api/public/fila/consulta?codigo=${encodeURIComponent(codigo)}`)
        .then(resp => resp.json())
        .then(data => {

            document.getElementById('resultado').classList.add('d-none');
            document.getElementById('erro').classList.add('d-none');

            if (data.erro) {
                document.getElementById('erro').innerText = data.erro;
                document.getElementById('erro').classList.remove('d-none');
                return;
            }

            document.getElementById('status').innerText = data.status;
            document.getElementById('posicao').innerText = data.posicao;
            document.getElementById('frente').innerText = data.pacientes_a_frente;
            document.getElementById('especialidade').innerText = data.especialidade;
            document.getElementById('atualizacao').innerText = data.ultima_atualizacao;

            document.getElementById('resultado').classList.remove('d-none');
        });
}
</script>

</body>
</html>
